<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Красивый Дашборд</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
<script>
function launchVM(vm_id) {
    fetch('/launch_vm/' + encodeURIComponent(vm_id), {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
    })
    .catch(error => {
        alert('Ошибка при запуске VM: ' + error);
    });
}
</script>
</head>
<body>
<h1>Дашборд</h1>
<div class="chessboard">
<!-- Виртуалки -->
<section id="virtuals">
<div class="collapsible-section animated-border">
<h2 class="section-header">Виртуальные машины <span class="toggle-icon">▼</span></h2>
<div class="section-content">
<div class="cards">
{% for vm_id, url in virtuals.items() %}
<div class="card" ondblclick="launchVM('{{ vm_id }}')">
  <strong>{{ vm_id }}</strong><br/>
  {{ url }}
</div>
{% endfor %}
</div>
</div>
</div>
</section>

<!-- Сайты -->
<section id="sites">
<div class="collapsible-section animated-border">
<h2 class="section-header">Сайты <span class="toggle-icon">▼</span></h2>
<div class="section-content">
<ul>
{% for block in blocks['links'] %}
<li><a href="{{ block.url }}" target="_blank">{{ block.name }}</a></li>
{% endfor %}
</ul>
</div>
</div>
</section>

<!-- Переходы -->
<section id="transitions">
<div class="collapsible-section animated-border">
<h2 class='section-header'>Переходы <span class='toggle-icon'>▼</span></h2>
<div class='section-content'>
<ul>
{% for block in blocks['transitions'] %}
<li><a href="{{ block.url }}" target="_blank">{{ block.name }}</a></li>
{% endfor %}
</ul>
</div>
</div>
</section>

<!-- Виджеты -->
<section id="widgets">
<div class="collapsible-section animated-border">
<h2 class='section-header'>Виджеты <span class='toggle-icon'>▼</span></h2>
<div class='section-content'>
<div id='clock'></div>
<div id='ip-address'></div>
<div id='weather'></div> <!-- Добавляем блок для погоды -->
</div>
</div>
</section>

<!-- Полезные кнопки -->
<section id='utilities'>
<div class='collapsible-section animated-border'>
<h2 class='section-header'>Полезные кнопки <span class='toggle-icon'>▼</span></h2>
<div class='section-content'>
<button onclick='window.open("http://monitoring.example.com")'>Мониторинг</button>
<button onclick='window.open("http://database.example.com")'>База данных</button>
<button onclick='window.open("https://pos.gususlugi.ru/admin")'>ПОС Админка</button>
<button onclick='window.open("https://webmail.tambov.gov.ru/postfixadmin")'>Почта</button>
<button onclick='window.open("admin.html")'>Админка Dashboard`a</button>
</div>
</div>
</section>

</div>
<script>
// Функция для отображения текущих даты и времени
function updateClock() {
    const clockDiv = document.getElementById('clock');
    const now = new Date();
    const options = { 
        year: 'numeric', month: 'numeric', day: 'numeric', 
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false 
    };
    clockDiv.textContent = now.toLocaleString('ru-RU', options);
}
setInterval(updateClock, 1000);
updateClock(); // сразу при загрузке

// Получение IP-адреса устройства
function getIPAddress() {
    // Используем сторонний API для получения IP
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            document.getElementById('ip-address').textContent = 'IP: ' + data.ip;
        })
        .catch(() => {
            document.getElementById('ip-address').textContent = 'IP: Не удалось определить';
        });
}
getIPAddress();

// Получение погоды через OpenWeatherMap API
function getWeather() {
    const apiKey = '35521c73a5973665a6acb6b4dc293bcb'; // вставьте ваш API ключ сюда
    const city = 'Tambov'; // укажите нужный город
    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=ru&appid=${apiKey}`)
        .then(response => response.json())
        .then(data => {
            if (data.weather && data.main) {
                const weatherDiv = document.getElementById('weather');
                const description = data.weather[0].description;
                const temp = Math.round(data.main.temp);
                weatherDiv.innerHTML = `Погода в ${city}: ${description}, ${temp}&deg;C`;
            } else {
                document.getElementById('weather').textContent = 'Погода недоступна';
            }
        })
        .catch(() => {
            document.getElementById('weather').textContent = 'Ошибка получения погоды';
        });
}
getWeather();
</script>
<script src="{{ url_for('static', filename='script.js') }}"></script>

<!-- Можно добавить сюда дополнительные скрипты, если нужно -->

</body>
</html>